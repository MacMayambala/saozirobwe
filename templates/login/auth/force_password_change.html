{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Change Password - Sao Zirobwe SACCO</title>
<link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<style>
/* Same styling as before */
body { font-family: 'Nunito', sans-serif; background: #f4f6f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin:0;}
.card { max-width:400px; width:100%; padding:30px; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.15); background:#fff;}
.password-strength { height:8px; border-radius:5px; margin-top:5px; }
.strength-weak { background-color:#dc3545; width:33%; }
.strength-medium { background-color:#ffc107; width:66%; }
.strength-strong { background-color:#28a745; width:100%; }
</style>
</head>
<body>
<div class="card">
    <h3 class="text-center mb-3">Change Password</h3>
    <p class="text-center text-muted mb-4">Please set a new password before continuing.</p>

    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-danger{% endif %} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    <form method="post" id="passwordForm">
        {% csrf_token %}
        <div class="mb-3">
            {{ form.new_password1|add_class:"form-control"|attr:"id:new_password"|attr:"placeholder:New Password" }}
            <div class="password-strength mt-1" id="strengthBar"></div>
        </div>
        <div class="mb-3">
            {{ form.new_password2|add_class:"form-control"|attr:"id:confirm_password"|attr:"placeholder:Confirm Password" }}
            <small id="matchMessage" style="color:red;"></small>
        </div>
        <button type="submit" class="btn btn-success" id="submitBtn" disabled>Update Password</button>
    </form>
</div>

<script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script>
const newPassword = document.getElementById('new_password');
const confirmPassword = document.getElementById('confirm_password');
const submitBtn = document.getElementById('submitBtn');
const strengthBar = document.getElementById('strengthBar');
const matchMessage = document.getElementById('matchMessage');

function checkStrength(password){
    if(password.length<6){ strengthBar.className='password-strength strength-weak'; return 'weak'; }
    else if(password.match(/(?=.*[0-9])(?=.*[a-zA-Z])/)){ strengthBar.className='password-strength strength-medium'; return 'medium'; }
    else{ strengthBar.className='password-strength strength-strong'; return 'strong'; }
}

function validateForm(){
    const pwd = newPassword.value;
    const confirm = confirmPassword.value;
    const strength = checkStrength(pwd);
    if(pwd===confirm && pwd.length>=6 && strength!=='weak'){ matchMessage.textContent=''; submitBtn.disabled=false; }
    else{ 
        if(pwd!==confirm && confirm.length>0){ matchMessage.textContent='Passwords do not match'; }
        else{ matchMessage.textContent=''; }
        submitBtn.disabled=true;
    }
}

newPassword.addEventListener('input', validateForm);
confirmPassword.addEventListener('input', validateForm);
</script>
</body>
</html>
